Date.prototype.format=function(t){let e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(let l in e)new RegExp("("+l+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?e[l]:("00"+e[l]).substr((""+e[l]).length)));return t},AV.init({appId:"S2fJ4HuOfyF5zuDGNuKi6maF-gzGzoHsz",appKey:"dRCwn1pyg4DBXiw06kchF3KB",serverURL:"https://s2fj4huo.lc-cn-n1-shared.com"});let queryBill=new AV.Query("Bill");const PAY_TYPE={0:"汪成,張弛",1:"汪成,李瑞豪",2:"張弛,李瑞豪",3:"汪成,張弛,李瑞豪"},PAY_USER={0:"汪成",1:"張弛",2:"李瑞豪"};new Vue({el:"#bill",data:{load:{more:!1,start:0,count:15,offset:0},monthBill:{payType0:0,payType1:0,payType2:0,payType3:0,payUser0:0,payUser1:0,payUser2:0},bills:[],month:(new Date).format("yyyy-MM"),hideWc:!1},computed:{monthTotalBill:function(){return(this.monthBill.payUser0+this.monthBill.payUser1+this.monthBill.payUser2).toFixed(2)},wcBill:function(){return this.countBill(this.monthBill.payType0+this.monthBill.payType1)},zcBill:function(){return this.countBill(this.monthBill.payType0+this.monthBill.payType2)},lrhBill:function(){return this.countBill(this.monthBill.payType1+this.monthBill.payType2)}},watch:{month:function(t){this.getMonthBill(),this.hideWc=t<"2021-06"}},methods:{getBillData:function(){let t=this;queryBill.descending("createdAt").skip(t.load.start*t.load.count+t.load.offset).limit(t.load.count).find().then(function(e){let l=e.length;if(l>0)for(bill of(t.load.more=l===t.load.count,e))t.bills.push({pay:bill.attributes.pay,payType:PAY_TYPE[bill.attributes.pay_type],payUser:PAY_USER[bill.attributes.pay_user],payDescription:bill.attributes.pay_description,payDt:new Date(bill.createdAt).format("yyyy-MM-dd hh:mm:ss")});else t.load.more=!1})},getMonthBill:function(){let t=this,e=(new Date).format(`${t.month.replace("-","/")}/01 00:00:00`),l=new Date(e),i=new Date(new Date(e).setMonth(l.getMonth()+1)),n=new AV.Query("Bill");n.greaterThanOrEqualTo("createdAt",l);let o=new AV.Query("Bill");o.lessThan("createdAt",i);let a=AV.Query.and(n,o);a.find().then(function(e){for(let e in t.monthBill)t.monthBill[e]=0;for(bill of e){let{pay:e,pay_type:l,pay_user:i}=bill.attributes;t.monthBill[`payType${l}`]+=e,t.monthBill[`payUser${i}`]+=e}})},loadMore:function(){this.load.more&&(this.load.start++,this.getBillData())},countBill:function(t){return(t/2+this.monthBill.payType3/3).toFixed(2)},toFixed:function(t){return Number(t).toFixed(2)}},created:function(){console.warn("青山不改，綠水長流，兄弟們江湖再見！")},mounted:function(){let t=this;t.getMonthBill(),t.getBillData(),document.querySelector(".submit").addEventListener("click",function(e){e.preventDefault();let l=document.querySelector("#form-pay"),i=new AV.Object("Bill"),n=Number(l.pay.value),o=Number(l.pay_type.value),a=Number(l.pay_user.value),r=l.pay_description.value;return 0===n?alert("又没写金额哦！"):r?(i.set("pay",n),i.set("pay_type",o),i.set("pay_user",a),i.set("pay_description",r),void i.save().then(e=>{t.monthBill[`payType${o}`]+=n,t.monthBill[`payUser${a}`]+=n;let i=document.querySelector(".bill-history");i.innerHTML=`<li>\n             <div>${(new Date).format("yyyy-MM-dd hh:mm:ss")}</div>\n             <p class="bill-description">${r}</p>\n             <span>${PAY_TYPE[o]}</span>,\n             消费 <strong>${n}</strong> 元, <span>付款: ${PAY_USER[a]}</span>\n          </li>`+i.innerHTML,t.load.offset++,l.reset()},function(t){console.error(JSON.stringify(t)),alert("完蛋保存失敗了，网络不好吧！")})):alert("北鼻，买了啥描述一下嘛~")})}});